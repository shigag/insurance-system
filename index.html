<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××œ××“ ×œ×¡×•×›×Ÿ ×”×‘×™×˜×•×— - ×¢× ×™×‘×•× ××§×¡×œ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            animation: slideUp 0.3s ease;
            min-width: 300px;
            text-align: center;
            font-weight: 500;
        }
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        .toast-success { background: #10b981; color: white; }
        .toast-error { background: #ef4444; color: white; }
        .toast-warning { background: #f59e0b; color: white; }
        .input-error { border-color: #ef4444 !important; background: #fef2f2; }
        .required-label::after { content: ' *'; color: #ef4444; }
        .table-row:hover { background: #f9fafb; }
        .policy-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .policy-card:hover {
            transform: translateX(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .file-preview { 
            max-width: 150px; 
            max-height: 150px; 
            object-fit: cover; 
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #e5e7eb;
        }
        .file-item {
            position: relative;
            display: inline-block;
            margin: 8px;
        }
        .file-item .delete-file {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .file-item .delete-file:hover {
            background: #dc2626;
        }
        .scan-icon {
            width: 150px;
            height: 150px;
            background: #f3f4f6;
            border: 2px dashed #9ca3af;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
        }
        .modal-overlay {
            backdrop-filter: blur(2px);
        }
        .import-box {
            border: 3px dashed #3b82f6;
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            transition: all 0.3s;
        }
        .import-box:hover {
            border-color: #2563eb;
            background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 100%);
            transform: scale(1.02);
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        @media (max-width: 768px) {
            .modal-overlay > div {
                max-height: 90vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Bell = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>;
        const Chart = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>;
        const Users = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>;
        const Document = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>;
        const Plus = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
        const Edit = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
        const Trash = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
        const Close = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
        const Upload = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>;
        const Eye = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>;
        const Calendar = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>;
        const ChevronDown = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>;
        const ChevronUp = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" /></svg>;
        const Refresh = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>;
        const Scan = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>;
        const Download = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>;

        function App() {
          const [tab, setTab] = useState('dashboard');
          const [clients, setClients] = useState([]);
          const [policies, setPolicies] = useState([]);
          const [modal, setModal] = useState(null);
          const [form, setForm] = useState({});
          const [importing, setImporting] = useState(false);
          const [progress, setProgress] = useState(0);
          const [search, setSearch] = useState('');
          const [viewClient, setViewClient] = useState(null);
          const [viewPolicy, setViewPolicy] = useState(null);
          const [expandedMonths, setExpandedMonths] = useState({});
          const [toast, setToast] = useState(null);
          const [confirmDialog, setConfirmDialog] = useState(null);
          const [saving, setSaving] = useState(false);
          const [errors, setErrors] = useState({});
          const [selectedClient, setSelectedClient] = useState(null);
          const [uploadingFile, setUploadingFile] = useState(false);
          const [viewImage, setViewImage] = useState(null);
          const [showImportWelcome, setShowImportWelcome] = useState(false);
          const [filterType, setFilterType] = useState(null);

          useEffect(() => {
            const c = localStorage.getItem('clients');
            const p = localStorage.getItem('policies');
            if (c) {
              setClients(JSON.parse(c));
              setPolicies(JSON.parse(p));
            } else {
              // Show import welcome screen if no data exists
              setShowImportWelcome(true);
            }
          }, []);

          useEffect(() => { if (clients.length > 0) localStorage.setItem('clients', JSON.stringify(clients)); }, [clients]);
          useEffect(() => { if (policies.length > 0) localStorage.setItem('policies', JSON.stringify(policies)); }, [policies]);

          // Toast notifications
          const showToast = (message, type = 'success') => {
            setToast({ message, type });
            setTimeout(() => setToast(null), 3000);
          };

          // Confirm dialog
          const showConfirm = (message, onConfirm) => {
            setConfirmDialog({ message, onConfirm });
          };

          const getDaysLeft = (endDate) => {
            if (!endDate) return null;
            const end = new Date(endDate);
            const today = new Date();
            const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
            return diff;
          };

          const getClientPolicies = (clientId) => {
            return policies.filter(p => p.clientId === clientId);
          };

          const getUpcomingRenewals = () => {
            const renewals = policies.filter(p => {
              const days = getDaysLeft(p.endDate);
              return days !== null && days <= 60 && days > 0;
            }).sort((a, b) => new Date(a.endDate) - new Date(b.endDate));

            const grouped = {};
            renewals.forEach(p => {
              const months = Math.ceil(getDaysLeft(p.endDate) / 30);
              const key = months <= 1 ? '×—×•×“×© ××—×“' : `${months} ×—×•×“×©×™×`;
              if (!grouped[key]) grouped[key] = [];
              grouped[key].push(p);
            });
            return grouped;
          };

          const getRenewalsByMonth = () => {
            const today = new Date();
            const monthsAhead = 12; // Show next 12 months
            const grouped = {};

            policies.forEach(p => {
              if (!p.endDate) return;
              const endDate = new Date(p.endDate);
              
              // Check if policy ends in the next 12 months
              const diffTime = endDate - today;
              const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
              
              if (diffDays >= 0 && diffDays <= 365) {
                const monthYear = endDate.toLocaleDateString('he-IL', { year: 'numeric', month: 'long' });
                if (!grouped[monthYear]) {
                  grouped[monthYear] = {
                    policies: [],
                    date: endDate
                  };
                }
                grouped[monthYear].policies.push(p);
              }
            });

            // Sort by date
            return Object.entries(grouped)
              .sort((a, b) => a[1].date - b[1].date)
              .reduce((acc, [key, value]) => {
                acc[key] = value.policies;
                return acc;
              }, {});
          };

          const validateForm = (type) => {
            const newErrors = {};
            
            if (type === 'client') {
              if (!form.name) newErrors.name = true;
              if (!form.idNumber) newErrors.idNumber = true;
              if (!form.phone1) newErrors.phone1 = true;
            } else if (type === 'policy') {
              if (!form.clientId) newErrors.clientId = true;
              if (!form.policyNumber) newErrors.policyNumber = true;
              if (!form.policyType) newErrors.policyType = true;
              if (!form.company) newErrors.company = true;
              if (!form.startDate) newErrors.startDate = true;
              if (!form.endDate) newErrors.endDate = true;
            }
            
            setErrors(newErrors);
            return Object.keys(newErrors).length === 0;
          };

          const handleAddClient = () => {
            if (!validateForm('client')) {
              showToast('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×”', 'error');
              return;
            }

            setSaving(true);
            setTimeout(() => {
              const newClient = {
                ...form,
                id: Date.now()
              };
              setClients([...clients, newClient]);
              setModal(null);
              setForm({});
              setErrors({});
              setSaving(false);
              showToast('×”×œ×§×•×— × ×•×¡×£ ×‘×”×¦×œ×—×”');
            }, 500);
          };

          const handleEditClient = () => {
            if (!validateForm('client')) {
              showToast('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×”', 'error');
              return;
            }

            setSaving(true);
            setTimeout(() => {
              setClients(clients.map(c => c.id === form.id ? form : c));
              setViewClient(form);
              setModal(null);
              setForm({});
              setErrors({});
              setSaving(false);
              showToast('×”×œ×§×•×— ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”');
            }, 500);
          };

          const handleDeleteClient = (id) => {
            showConfirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×œ×§×•×— ×–×”?', () => {
              const clientPolicies = getClientPolicies(id);
              setPolicies(policies.filter(p => p.clientId !== id));
              setClients(clients.filter(c => c.id !== id));
              setViewClient(null);
              showToast(`×”×œ×§×•×— × ××—×§ ×‘×”×¦×œ×—×” (${clientPolicies.length} ×¤×•×œ×™×¡×•×ª × ××—×§×•)`);
            });
          };

          const handleAddPolicy = () => {
            if (!validateForm('policy')) {
              showToast('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×”', 'error');
              return;
            }

            setSaving(true);
            setTimeout(() => {
              const newPolicy = {
                ...form,
                id: Date.now(),
                scans: []
              };
              setPolicies([...policies, newPolicy]);
              setModal(null);
              setForm({});
              setErrors({});
              setSaving(false);
              showToast('×”×¤×•×œ×™×¡×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”');
            }, 500);
          };

          const handleEditPolicy = () => {
            if (!validateForm('policy')) {
              showToast('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×”', 'error');
              return;
            }

            setSaving(true);
            setTimeout(() => {
              setPolicies(policies.map(p => p.id === form.id ? { ...form, scans: p.scans } : p));
              setViewPolicy({ ...form, scans: policies.find(p => p.id === form.id)?.scans || [] });
              setModal(null);
              setForm({});
              setErrors({});
              setSaving(false);
              showToast('×”×¤×•×œ×™×¡×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”');
            }, 500);
          };

          const handleDeletePolicy = (id) => {
            showConfirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×¤×•×œ×™×¡×” ×–×•?', () => {
              setPolicies(policies.filter(p => p.id !== id));
              setViewPolicy(null);
              showToast('×”×¤×•×œ×™×¡×” × ××—×§×” ×‘×”×¦×œ×—×”');
            });
          };

          // Enhanced Excel import with proper client grouping
          const handleExcelImport = (e) => {
            const file = e.target.files[0];
            if (!file) return;

            setImporting(true);
            setProgress(0);

            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const workbook = XLSX.read(event.target.result, { type: 'binary', cellDates: true });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(firstSheet);

                if (data.length === 0) {
                  showToast('×”×§×•×‘×¥ ×¨×™×§', 'error');
                  setImporting(false);
                  return;
                }

                setProgress(30);

                // Helper functions
                const cleanValue = (val) => {
                  if (val === null || val === undefined || val === 'NaN' || val === '') return '';
                  return String(val).trim();
                };

                const formatDate = (dateVal) => {
                  if (!dateVal) return '';
                  try {
                    if (dateVal instanceof Date) {
                      return dateVal.toISOString().split('T')[0];
                    }
                    const date = new Date(dateVal);
                    if (!isNaN(date.getTime())) {
                      return date.toISOString().split('T')[0];
                    }
                  } catch (e) {
                    console.error('Date parsing error:', e);
                  }
                  return '';
                };

                setProgress(50);

                // Group by client ID
                const clientsMap = new Map();
                const policiesArray = [];

                let clientIdCounter = 1;
                let policyIdCounter = 1;

                data.forEach((row, index) => {
                  const clientId = cleanValue(row['ID']);
                  if (!clientId) return;

                  // Create or get client
                  if (!clientsMap.has(clientId)) {
                    const client = {
                      id: clientIdCounter++,
                      name: cleanValue(row['Family name']) || '×œ× ×¦×•×™×Ÿ',
                      firstName: cleanValue(row['First name']),
                      idNumber: clientId,
                      birthDate: formatDate(row['D.O.B']),
                      email1: cleanValue(row['Email 1']),
                      email2: cleanValue(row['Email 2']),
                      email3: cleanValue(row['Email 3']),
                      phone1: cleanValue(row['Phone 1']),
                      phone1Type: cleanValue(row['Type phone 1']),
                      phone2: cleanValue(row['Phone 2']),
                      phone2Type: cleanValue(row['Type phone 2']),
                      phone3: cleanValue(row['Phone 3']),
                      phone3Type: cleanValue(row['Type phone 3']),
                      notes: ''
                    };
                    clientsMap.set(clientId, client);
                  }

                  // Create policy for this client
                  const client = clientsMap.get(clientId);
                  const policy = {
                    id: policyIdCounter++,
                    clientId: client.id,
                    policyNumber: cleanValue(row['Policy #']),
                    policyType: cleanValue(row['Policy type']),
                    insuranceType: cleanValue(row['Insurance type']),
                    company: cleanValue(row['Insurance company']),
                    startDate: formatDate(row['Policy start']),
                    endDate: formatDate(row['Policy END']),
                    premium: cleanValue(row['ANAF']),
                    carNumber: cleanValue(row['Car #']),
                    notes: '',
                    scans: []
                  };
                  policiesArray.push(policy);

                  setProgress(50 + (index / data.length) * 40);
                });

                setProgress(95);

                const importedClients = Array.from(clientsMap.values());
                
                // Merge with existing data
                setClients(importedClients);
                setPolicies(policiesArray);

                setProgress(100);
                showToast(`× ×•×¡×£ ×‘×”×¦×œ×—×”! ${importedClients.length} ×œ×§×•×—×•×ª, ${policiesArray.length} ×¤×•×œ×™×¡×•×ª`);
                setShowImportWelcome(false);
                
                setTimeout(() => {
                  setImporting(false);
                  setProgress(0);
                }, 1000);

              } catch (error) {
                console.error('Import error:', error);
                showToast('×©×’×™××” ×‘×™×™×‘×•× ×”×§×•×‘×¥', 'error');
                setImporting(false);
              }
            };
            reader.readAsBinaryString(file);
          };

          const handleExport = () => {
            const exportData = clients.map(client => {
              const clientPolicies = getClientPolicies(client.id);
              return clientPolicies.map(policy => ({
                '××¡×¤×¨ ×¤×•×œ×™×¡×”': policy.policyNumber,
                '×©× ×¤×¨×˜×™': client.firstName,
                '×©× ××©×¤×—×”': client.name,
                '×ª×¢×•×“×ª ×–×”×•×ª': client.idNumber,
                '×ª××¨×™×š ×œ×™×“×”': client.birthDate,
                '××™××™×™×œ 1': client.email1,
                '××™××™×™×œ 2': client.email2,
                '××™××™×™×œ 3': client.email3,
                '×˜×œ×¤×•×Ÿ 1': client.phone1,
                '×¡×•×’ ×˜×œ×¤×•×Ÿ 1': client.phone1Type,
                '×˜×œ×¤×•×Ÿ 2': client.phone2,
                '×¡×•×’ ×˜×œ×¤×•×Ÿ 2': client.phone2Type,
                '×˜×œ×¤×•×Ÿ 3': client.phone3,
                '×¡×•×’ ×˜×œ×¤×•×Ÿ 3': client.phone3Type,
                '×¡×•×’ ×¤×•×œ×™×¡×”': policy.policyType,
                '×¡×•×’ ×‘×™×˜×•×—': policy.insuranceType,
                '×—×‘×¨×ª ×‘×™×˜×•×—': policy.company,
                '×¤×¨××™×”': policy.premium,
                '×ª××¨×™×š ×ª×—×™×œ×”': policy.startDate,
                '×ª××¨×™×š ×¡×™×•×': policy.endDate,
                '××¡×¤×¨ ×¨×›×‘': policy.carNumber
              }));
            }).flat();

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '×œ×§×•×—×•×ª ×•×¤×•×œ×™×¡×•×ª');
            XLSX.writeFile(wb, `clients_export_${new Date().toISOString().split('T')[0]}.xlsx`);
            showToast('×”×§×•×‘×¥ ×™×•×¦× ×‘×”×¦×œ×—×”');
          };

          const handleFileUpload = async (e, policyId) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            setUploadingFile(true);

            try {
              const newScans = [];
              
              for (const file of files) {
                const reader = new FileReader();
                const fileData = await new Promise((resolve, reject) => {
                  reader.onload = (e) => resolve(e.target.result);
                  reader.onerror = reject;
                  reader.readAsDataURL(file);
                });

                newScans.push({
                  name: file.name,
                  type: file.type,
                  data: fileData,
                  uploadDate: new Date().toISOString()
                });
              }

              setPolicies(prevPolicies => 
                prevPolicies.map(p => 
                  p.id === policyId 
                    ? { ...p, scans: [...(p.scans || []), ...newScans] }
                    : p
                )
              );

              if (viewPolicy && viewPolicy.id === policyId) {
                setViewPolicy(prev => ({
                  ...prev,
                  scans: [...(prev.scans || []), ...newScans]
                }));
              }

              showToast(`${files.length} ×§×‘×¦×™× ×”×•×¢×œ×• ×‘×”×¦×œ×—×”`);
            } catch (error) {
              console.error('File upload error:', error);
              showToast('×©×’×™××” ×‘×”×¢×œ××ª ×”×§×‘×¦×™×', 'error');
            } finally {
              setUploadingFile(false);
            }
          };

          const deleteFile = (policyId, fileIndex) => {
            showConfirm('×”×× ×œ××—×•×§ ××ª ×”×§×•×‘×¥?', () => {
              setPolicies(prevPolicies =>
                prevPolicies.map(p =>
                  p.id === policyId
                    ? { ...p, scans: p.scans.filter((_, i) => i !== fileIndex) }
                    : p
                )
              );

              if (viewPolicy && viewPolicy.id === policyId) {
                setViewPolicy(prev => ({
                  ...prev,
                  scans: prev.scans.filter((_, i) => i !== fileIndex)
                }));
              }

              showToast('×”×§×•×‘×¥ × ××—×§ ×‘×”×¦×œ×—×”');
            });
          };

          // Handle dashboard card clicks
          const handleDashboardCardClick = (type) => {
            setFilterType(type);
            if (type === 'clients') {
              setTab('clients');
            } else {
              setTab('policies');
            }
          };

          // Backup and Restore functions
          const handleBackup = () => {
            const backupData = {
              clients: clients,
              policies: policies,
              backupDate: new Date().toISOString(),
              version: '1.0'
            };

            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `insurance_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            showToast('×”×’×™×‘×•×™ × ×©××¨ ×‘×”×¦×œ×—×”! ğŸ’¾');
          };

          const handleRestore = (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const backupData = JSON.parse(event.target.result);
                
                // Validate backup data
                if (!backupData.clients || !backupData.policies) {
                  showToast('×§×•×‘×¥ ×’×™×‘×•×™ ×œ× ×ª×§×™×Ÿ', 'error');
                  return;
                }

                // Confirm before restoring
                showConfirm(
                  `×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×©×—×–×¨ ××ª ×”×’×™×‘×•×™ ××ª××¨×™×š ${new Date(backupData.backupDate).toLocaleDateString('he-IL')}? ×”× ×ª×•× ×™× ×”× ×•×›×—×™×™× ×™×•×—×œ×¤×•!`,
                  () => {
                    setClients(backupData.clients);
                    setPolicies(backupData.policies);
                    showToast(`×©×•×—×–×¨ ×‘×”×¦×œ×—×”! ${backupData.clients.length} ×œ×§×•×—×•×ª ×•-${backupData.policies.length} ×¤×•×œ×™×¡×•×ª ğŸ“‚`);
                  }
                );
              } catch (error) {
                console.error('Restore error:', error);
                showToast('×©×’×™××” ×‘×©×—×–×•×¨ ×”×’×™×‘×•×™', 'error');
              }
            };
            reader.readAsText(file);
            
            // Reset input
            e.target.value = '';
          };

          const getActivePoliciesCount = () => {
            return policies.filter(p => {
              if (!p.endDate) return true; // If no end date, consider active
              const endDate = new Date(p.endDate);
              const today = new Date();
              return endDate >= today;
            }).length;
          };

          const filteredClients = clients.filter(c => 
            c.name.includes(search) || 
            c.idNumber.includes(search) ||
            (c.firstName && c.firstName.includes(search)) ||
            (c.phone1 && c.phone1.includes(search))
          );

          const filteredPolicies = policies.filter(p => {
            const client = clients.find(c => c.id === p.clientId);
            const matchesSearch = p.policyNumber.includes(search) ||
                   (client && (client.name.includes(search) || client.idNumber.includes(search)));
            
            // Apply filterType from dashboard cards
            if (filterType === 'active') {
              const daysLeft = getDaysLeft(p.endDate);
              return matchesSearch && (daysLeft === null || daysLeft > 0);
            } else if (filterType === 'expired') {
              const daysLeft = getDaysLeft(p.endDate);
              return matchesSearch && (daysLeft !== null && daysLeft <= 0);
            } else if (filterType === 'renewals') {
              const daysLeft = getDaysLeft(p.endDate);
              return matchesSearch && (daysLeft !== null && daysLeft <= 60 && daysLeft > 0);
            } else if (filterType === 'scans') {
              return matchesSearch && (p.scans && p.scans.length > 0);
            }
            
            return matchesSearch;
          });

          return (
            <div className="min-h-screen bg-gray-50">
              {/* Header */}
              <div className="bg-gradient-to-r from-blue-600 to-indigo-700 text-white py-4 px-4 md:py-6 md:px-8 shadow-lg">
                <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-3 md:gap-0">
                  <div className="text-center md:text-right">
                    <h1 className="text-xl md:text-3xl font-bold mb-1 md:mb-2">ğŸ“Š ××¢×¨×›×ª × ×™×”×•×œ ×œ×§×•×—×•×ª ×•×‘×™×˜×•×—×™×</h1>
                    <p className="text-blue-100 text-sm md:text-base">× ×™×”×•×œ ××§×¦×•×¢×™ ×©×œ ×œ×§×•×—×•×ª ×•×¤×•×œ×™×¡×•×ª ×‘×™×˜×•×—</p>
                  </div>
                  <button
                    onClick={() => setConfirmDialog({
                      message: 'âš ï¸ ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ × ×ª×•× ×™ ×”×œ×§×•×—×•×ª ×•×”×¤×•×œ×™×¡×•×ª? ×¤×¢×•×œ×” ×–×• ××™× ×” × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!',
                      onConfirm: () => {
                        setClients([]);
                        setPolicies([]);
                        localStorage.removeItem('clients');
                        localStorage.removeItem('policies');
                        showToast('×›×œ ×”× ×ª×•× ×™× × ××—×§×• ×‘×”×¦×œ×—×”', 'success');
                      }
                    })}
                    className="flex items-center gap-2 px-3 py-2 md:px-4 md:py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold text-xs md:text-sm transition-colors border-2 border-red-700 whitespace-nowrap"
                    title="××—×™×§×ª ×›×œ × ×ª×•× ×™ ×”×œ×§×•×—×•×ª ×•×”×¤×•×œ×™×¡×•×ª"
                  >
                    <Trash className="w-4 h-4 md:w-5 md:h-5" />
                    <span className="hidden sm:inline">××—×™×§×ª ×›×œ ×”× ×ª×•× ×™×</span>
                    <span className="sm:hidden">××—×§ ×”×›×œ</span>
                  </button>
                </div>
              </div>

              {/* Import Welcome Screen */}
              {showImportWelcome && clients.length === 0 && (
                <div className="fixed inset-0 bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4 z-50">
                  <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8">
                    <div className="text-center mb-8">
                      <div className="inline-block p-4 bg-blue-100 rounded-full mb-4">
                        <Upload className="w-16 h-16 text-blue-600" />
                      </div>
                      <h2 className="text-3xl font-bold text-gray-800 mb-2">×‘×¨×•×›×™× ×”×‘××™×!</h2>
                      <p className="text-gray-600 text-lg">×”×ª×—×œ ×¢×œ ×™×“×™ ×™×™×‘×•× ×§×•×‘×¥ ×”××§×¡×œ ×©×œ×š</p>
                    </div>

                    <div className="import-box rounded-xl p-8 mb-6 text-center cursor-pointer">
                      <label className="cursor-pointer block">
                        <Document className="w-20 h-20 text-blue-600 mx-auto mb-4" />
                        <div className="text-xl font-bold text-gray-800 mb-2">×™×‘×•× ×§×•×‘×¥ ××§×¡×œ</div>
                        <div className="text-gray-600 mb-4">
                          ×’×¨×•×¨ ×§×•×‘×¥ ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”<br/>
                          <span className="text-sm text-gray-500">×ª×•××š ×‘×§×‘×¦×™ .xlsx ×•-.xls</span>
                        </div>
                        <input 
                          type="file" 
                          accept=".xlsx,.xls" 
                          onChange={handleExcelImport}
                          className="hidden"
                          disabled={importing}
                        />
                        {importing && (
                          <div className="mt-4">
                            <div className="w-full bg-gray-200 rounded-full h-3 mb-2">
                              <div 
                                className="bg-blue-600 h-3 rounded-full progress-bar" 
                                style={{ width: `${progress}%` }}
                              />
                            </div>
                            <div className="text-blue-600 font-semibold">{Math.round(progress)}% - ××™×™×‘× × ×ª×•× ×™×...</div>
                          </div>
                        )}
                      </label>
                    </div>

                    <div className="text-center">
                      <button
                        onClick={() => setShowImportWelcome(false)}
                        className="text-gray-500 hover:text-gray-700 underline"
                      >
                        ×“×œ×’ ×•×ª×ª×—×™×œ ×¢× ××¢×¨×›×ª ×¨×™×§×”
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Navigation */}
              <div className="bg-white border-b shadow-sm sticky top-0 z-40">
                <div className="max-w-7xl mx-auto px-2 md:px-8">
                  <div className="flex gap-1 overflow-x-auto scrollbar-hide">
                    <button 
                      onClick={() => {
                        setTab('dashboard');
                        setFilterType(null);
                      }} 
                      className={`flex items-center gap-2 px-4 md:px-6 py-3 md:py-4 font-semibold transition-all whitespace-nowrap text-sm md:text-base ${tab === 'dashboard' ? 'border-b-4 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      <Chart className="w-4 h-4 md:w-5 md:h-5" />
                      <span className="hidden sm:inline">×œ×•×— ×‘×§×¨×”</span>
                      <span className="sm:hidden">×‘×§×¨×”</span>
                    </button>
                    <button 
                      onClick={() => {
                        setTab('clients');
                        setFilterType(null);
                      }} 
                      className={`flex items-center gap-2 px-4 md:px-6 py-3 md:py-4 font-semibold transition-all whitespace-nowrap text-sm md:text-base ${tab === 'clients' ? 'border-b-4 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      <Users className="w-4 h-4 md:w-5 md:h-5" />
                      ×œ×§×•×—×•×ª ({clients.length})
                    </button>
                    <button 
                      onClick={() => {
                        setTab('policies');
                        setFilterType(null);
                      }} 
                      className={`flex items-center gap-2 px-4 md:px-6 py-3 md:py-4 font-semibold transition-all whitespace-nowrap text-sm md:text-base ${tab === 'policies' ? 'border-b-4 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      <Document className="w-4 h-4 md:w-5 md:h-5" />
                      ×¤×•×œ×™×¡×•×ª ({policies.length})
                    </button>
                    <button 
                      onClick={() => {
                        setTab('renewals');
                        setFilterType(null);
                      }} 
                      className={`flex items-center gap-2 px-4 md:px-6 py-3 md:py-4 font-semibold transition-all whitespace-nowrap text-sm md:text-base ${tab === 'renewals' ? 'border-b-4 border-blue-600 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                    >
                      <Bell className="w-4 h-4 md:w-5 md:h-5" />
                      ×ª×–×›×•×¨×•×ª
                    </button>
                  </div>
                </div>
              </div>

              {/* Main Content */}
              <div className="max-w-7xl mx-auto px-4 md:px-8 py-4 md:py-8">
                {/* Dashboard */}
                {tab === 'dashboard' && (
                  <div className="space-y-8">
                    {/* Stats Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6">
                      <div 
                        onClick={() => handleDashboardCardClick('clients')}
                        className="bg-white rounded-xl shadow-md p-6 border-r-4 border-blue-500 cursor-pointer hover:shadow-xl transition-shadow"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-gray-500 text-sm font-medium mb-1">×¡×”"×› ×œ×§×•×—×•×ª</div>
                            <div className="text-3xl font-bold text-gray-800">{clients.length}</div>
                          </div>
                          <Users className="w-12 h-12 text-blue-500 opacity-80" />
                        </div>
                      </div>

                      <div 
                        onClick={() => handleDashboardCardClick('active')}
                        className="bg-white rounded-xl shadow-md p-6 border-r-4 border-green-500 cursor-pointer hover:shadow-xl transition-shadow"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-gray-500 text-sm font-medium mb-1">×¤×•×œ×™×¡×•×ª ×¤×¢×™×œ×•×ª</div>
                            <div className="text-3xl font-bold text-gray-800">{getActivePoliciesCount()}</div>
                            <div className="text-xs text-gray-400 mt-1">×‘×ª×•×§×£</div>
                          </div>
                          <Document className="w-12 h-12 text-green-500 opacity-80" />
                        </div>
                      </div>

                      <div 
                        onClick={() => handleDashboardCardClick('expired')}
                        className="bg-white rounded-xl shadow-md p-6 border-r-4 border-red-500 cursor-pointer hover:shadow-xl transition-shadow"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-gray-500 text-sm font-medium mb-1">×¤×•×œ×™×¡×•×ª ×©×¤×’ ×ª×•×§×¤×Ÿ</div>
                            <div className="text-3xl font-bold text-gray-800">{policies.length - getActivePoliciesCount()}</div>
                            <div className="text-xs text-gray-400 mt-1">×œ× ×‘×ª×•×§×£</div>
                          </div>
                          <Calendar className="w-12 h-12 text-red-500 opacity-80" />
                        </div>
                      </div>

                      <div 
                        onClick={() => handleDashboardCardClick('renewals')}
                        className="bg-white rounded-xl shadow-md p-6 border-r-4 border-orange-500 cursor-pointer hover:shadow-xl transition-shadow"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-gray-500 text-sm font-medium mb-1">×—×™×“×•×©×™× ×‘×—×•×“×©×™×™×</div>
                            <div className="text-3xl font-bold text-gray-800">
                              {policies.filter(p => {
                                const days = getDaysLeft(p.endDate);
                                return days !== null && days <= 60 && days > 0;
                              }).length}
                            </div>
                          </div>
                          <Bell className="w-12 h-12 text-orange-500 opacity-80" />
                        </div>
                      </div>

                      <div 
                        onClick={() => handleDashboardCardClick('scans')}
                        className="bg-white rounded-xl shadow-md p-6 border-r-4 border-purple-500 cursor-pointer hover:shadow-xl transition-shadow"
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className="text-gray-500 text-sm font-medium mb-1">××¡××›×™× ×¡×¨×•×§×™×</div>
                            <div className="text-3xl font-bold text-gray-800">
                              {policies.reduce((sum, p) => sum + (p.scans?.length || 0), 0)}
                            </div>
                          </div>
                          <Scan className="w-12 h-12 text-purple-500 opacity-80" />
                        </div>
                      </div>
                    </div>

                    {/* Quick Actions */}
                    <div className="bg-white rounded-xl shadow-md p-6">
                      <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                        <span>âš¡</span>
                        ×¤×¢×•×œ×•×ª ××”×™×¨×•×ª
                      </h2>
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                        <button
                          onClick={() => {
                            setModal('client');
                            setForm({});
                            setErrors({});
                          }}
                          className="flex items-center justify-center gap-3 px-6 py-4 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
                        >
                          <Plus className="w-5 h-5" />
                          ×”×•×¡×¤×ª ×œ×§×•×— ×—×“×©
                        </button>
                        
                        <button
                          onClick={() => {
                            setModal('policy');
                            setForm({});
                            setErrors({});
                          }}
                          className="flex items-center justify-center gap-3 px-6 py-4 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors"
                        >
                          <Plus className="w-5 h-5" />
                          ×”×•×¡×¤×ª ×¤×•×œ×™×¡×” ×—×“×©×”
                        </button>

                        <label className="flex items-center justify-center gap-3 px-6 py-4 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 cursor-pointer transition-colors">
                          <Upload className="w-5 h-5" />
                          {importing ? '××™×™×‘×...' : '×™×‘×•× ×××§×¡×œ'}
                          <input 
                            type="file" 
                            accept=".xlsx,.xls" 
                            onChange={handleExcelImport}
                            className="hidden"
                            disabled={importing}
                          />
                        </label>

                        <button
                          onClick={handleBackup}
                          className="flex items-center justify-center gap-3 px-6 py-4 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                          title="×©××•×¨ ×’×™×‘×•×™ ×©×œ ×›×œ ×”× ×ª×•× ×™×"
                        >
                          <Download className="w-5 h-5" />
                          ×©××™×¨×ª ×’×™×‘×•×™
                        </button>

                        <label className="flex items-center justify-center gap-3 px-6 py-4 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 cursor-pointer transition-colors"
                          title="×©×—×–×¨ × ×ª×•× ×™× ××’×™×‘×•×™"
                        >
                          <Upload className="w-5 h-5" />
                          ×©×—×–×•×¨ ×’×™×‘×•×™
                          <input 
                            type="file" 
                            accept=".json" 
                            onChange={handleRestore}
                            className="hidden"
                          />
                        </label>
                      </div>
                    </div>

                    {/* Import Progress */}
                    {importing && (
                      <div className="bg-white rounded-xl shadow-md p-6">
                        <h3 className="text-lg font-bold mb-3">â³ ××™×™×‘× × ×ª×•× ×™×...</h3>
                        <div className="w-full bg-gray-200 rounded-full h-4">
                          <div 
                            className="bg-blue-600 h-4 rounded-full progress-bar flex items-center justify-center text-white text-xs font-semibold" 
                            style={{ width: `${progress}%` }}
                          >
                            {Math.round(progress)}%
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Recent Activity */}
                    {clients.length > 0 && (
                      <>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <div className="bg-white rounded-xl shadow-md p-6">
                            <h2 className="text-xl font-bold mb-4">ğŸ‘¥ ×œ×§×•×—×•×ª ××—×¨×•× ×™×</h2>
                            <div className="space-y-3">
                              {clients.slice(-5).reverse().map(client => (
                                <div 
                                  key={client.id}
                                  className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors"
                                  onClick={() => {
                                    setViewClient(client);
                                    setTab('clients');
                                  }}
                                >
                                  <div>
                                    <div className="font-semibold">{client.firstName} {client.name}</div>
                                    <div className="text-sm text-gray-500">{client.idNumber}</div>
                                  </div>
                                  <div className="text-sm font-medium text-blue-600">
                                    {getClientPolicies(client.id).length} ×¤×•×œ×™×¡×•×ª
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>

                          <div className="bg-white rounded-xl shadow-md p-6">
                            <h2 className="text-xl font-bold mb-4">â° ×—×™×“×•×©×™× ×§×¨×•×‘×™×</h2>
                            <div className="space-y-3">
                              {policies
                                .filter(p => {
                                  const days = getDaysLeft(p.endDate);
                                  return days !== null && days <= 30 && days > 0;
                                })
                                .sort((a, b) => new Date(a.endDate) - new Date(b.endDate))
                                .slice(0, 5)
                                .map(policy => {
                                  const client = clients.find(c => c.id === policy.clientId);
                                  const daysLeft = getDaysLeft(policy.endDate);
                                  return (
                                    <div 
                                      key={policy.id}
                                      className="flex items-center justify-between p-3 bg-orange-50 rounded-lg hover:bg-orange-100 cursor-pointer transition-colors"
                                      onClick={() => {
                                        setViewPolicy(policy);
                                        setTab('policies');
                                      }}
                                    >
                                      <div>
                                        <div className="font-semibold">{client?.firstName} {client?.name}</div>
                                        <div className="text-sm text-gray-500">{policy.policyType}</div>
                                      </div>
                                      <div className={`text-sm font-bold px-3 py-1 rounded-full ${
                                        daysLeft <= 7 ? 'bg-red-100 text-red-700' : 
                                        daysLeft <= 14 ? 'bg-orange-100 text-orange-700' : 
                                        'bg-yellow-100 text-yellow-700'
                                      }`}>
                                        {daysLeft} ×™××™×
                                      </div>
                                    </div>
                                  );
                                })}
                              {policies.filter(p => {
                                const days = getDaysLeft(p.endDate);
                                return days !== null && days <= 30 && days > 0;
                              }).length === 0 && (
                                <div className="text-center py-8 text-gray-500">
                                  ××™×Ÿ ×—×™×“×•×©×™× ×§×¨×•×‘×™×
                                </div>
                              )}
                            </div>
                          </div>
                        </div>

                        {/* Monthly Renewals Section */}
                        <div className="bg-white rounded-xl shadow-md p-6">
                          <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                            <Calendar className="w-6 h-6 text-blue-600" />
                            ×—×™×“×•×©×™× ×œ×¤×™ ×—×•×“×©×™× (12 ×—×•×“×©×™× ×”×§×¨×•×‘×™×)
                          </h2>
                          
                          {Object.keys(getRenewalsByMonth()).length === 0 ? (
                            <div className="text-center py-8 text-gray-500">
                              <Calendar className="w-16 h-16 text-gray-300 mx-auto mb-3" />
                              ××™×Ÿ ×—×™×“×•×©×™× ×‘×©× ×” ×”×§×¨×•×‘×”
                            </div>
                          ) : (
                            <div className="space-y-4">
                              {Object.entries(getRenewalsByMonth()).map(([monthYear, monthPolicies]) => {
                                const totalPolicies = monthPolicies.length;
                                const sampleDate = new Date(monthPolicies[0].endDate);
                                const daysUntilMonth = Math.ceil((sampleDate - new Date()) / (1000 * 60 * 60 * 24));
                                
                                return (
                                  <div key={monthYear} className="border-2 border-gray-200 rounded-lg overflow-hidden">
                                    <button
                                      onClick={() => setExpandedMonths({ ...expandedMonths, [monthYear]: !expandedMonths[monthYear] })}
                                      className={`w-full flex items-center justify-between p-4 transition-colors ${
                                        daysUntilMonth <= 30 ? 'bg-gradient-to-r from-red-50 to-orange-50 hover:from-red-100 hover:to-orange-100' :
                                        daysUntilMonth <= 60 ? 'bg-gradient-to-r from-orange-50 to-yellow-50 hover:from-orange-100 hover:to-yellow-100' :
                                        daysUntilMonth <= 90 ? 'bg-gradient-to-r from-yellow-50 to-green-50 hover:from-yellow-100 hover:to-green-100' :
                                        'bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100'
                                      }`}
                                    >
                                      <div className="flex items-center gap-3">
                                        <Calendar className={`w-6 h-6 ${
                                          daysUntilMonth <= 30 ? 'text-red-600' :
                                          daysUntilMonth <= 60 ? 'text-orange-600' :
                                          daysUntilMonth <= 90 ? 'text-yellow-600' :
                                          'text-blue-600'
                                        }`} />
                                        <div className="text-right">
                                          <div className="text-lg font-bold text-gray-800">{monthYear}</div>
                                          <div className="text-sm text-gray-600">
                                            {daysUntilMonth > 0 ? `×‘×¢×•×“ ${daysUntilMonth} ×™××™×` : '×”×—×•×“×©'}
                                          </div>
                                        </div>
                                      </div>
                                      <div className="flex items-center gap-3">
                                        <span className={`px-4 py-2 rounded-full text-sm font-bold ${
                                          daysUntilMonth <= 30 ? 'bg-red-200 text-red-800' :
                                          daysUntilMonth <= 60 ? 'bg-orange-200 text-orange-800' :
                                          daysUntilMonth <= 90 ? 'bg-yellow-200 text-yellow-800' :
                                          'bg-blue-200 text-blue-800'
                                        }`}>
                                          {totalPolicies} ×¤×•×œ×™×¡×•×ª
                                        </span>
                                        {expandedMonths[monthYear] ? (
                                          <ChevronUp className="w-5 h-5 text-gray-600" />
                                        ) : (
                                          <ChevronDown className="w-5 h-5 text-gray-600" />
                                        )}
                                      </div>
                                    </button>

                                    {expandedMonths[monthYear] && (
                                      <div className="p-4 bg-gray-50 space-y-2 max-h-96 overflow-y-auto">
                                        {monthPolicies.map(policy => {
                                          const client = clients.find(c => c.id === policy.clientId);
                                          const daysLeft = getDaysLeft(policy.endDate);
                                          return (
                                            <div
                                              key={policy.id}
                                              onClick={() => {
                                                setViewPolicy(policy);
                                                setTab('policies');
                                              }}
                                              className="flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-md cursor-pointer transition-all"
                                            >
                                              <div className="flex-1">
                                                <div className="font-bold text-gray-800">
                                                  {client?.firstName} {client?.name}
                                                </div>
                                                <div className="text-sm text-gray-600">
                                                  {policy.policyType} â€¢ {policy.company}
                                                </div>
                                                <div className="text-xs text-gray-500 mt-1">
                                                  ××¡×¤×¨: {policy.policyNumber} | ×ª×•×§×£ ×¢×“: {policy.endDate}
                                                </div>
                                              </div>
                                              <div className={`text-sm font-bold px-3 py-1 rounded-full whitespace-nowrap ${
                                                daysLeft <= 7 ? 'bg-red-100 text-red-700' :
                                                daysLeft <= 14 ? 'bg-orange-100 text-orange-700' :
                                                daysLeft <= 30 ? 'bg-yellow-100 text-yellow-700' :
                                                daysLeft <= 60 ? 'bg-blue-100 text-blue-700' :
                                                'bg-green-100 text-green-700'
                                              }`}>
                                                {daysLeft > 0 ? `${daysLeft} ×™××™×` : '×¤×’ ×ª×•×§×£'}
                                              </div>
                                            </div>
                                          );
                                        })}
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          )}
                        </div>
                      </>
                    )}
                  </div>
                )}

                {/* Clients Tab */}
                {tab === 'clients' && (
                  <div>
                    <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 mb-6">
                      <input
                        type="text"
                        placeholder="ğŸ” ×—×™×¤×•×© ×œ×§×•×—..."
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                        className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base sm:text-lg"
                      />
                      <div className="flex gap-2 sm:gap-3">
                        <button
                          onClick={() => {
                            setModal('client');
                            setForm({});
                            setErrors({});
                          }}
                          className="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 sm:px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors text-sm sm:text-base"
                        >
                          <Plus className="w-4 h-4 sm:w-5 sm:h-5" />
                          <span className="hidden sm:inline">×”×•×¡×¤×ª ×œ×§×•×—</span>
                          <span className="sm:hidden">×”×•×¡×£</span>
                        </button>
                        <button
                          onClick={handleExport}
                          className="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 sm:px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors text-sm sm:text-base"
                        >
                          <Download className="w-4 h-4 sm:w-5 sm:h-5" />
                          <span className="hidden sm:inline">×™×¦×•×</span>
                        </button>
                        <button
                          onClick={handleBackup}
                          className="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 sm:px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors text-sm sm:text-base"
                        >
                          <Download className="w-4 h-4 sm:w-5 sm:h-5" />
                          <span className="hidden sm:inline">×’×™×‘×•×™</span>
                        </button>
                      </div>
                    </div>

                    {filteredClients.length === 0 ? (
                      <div className="bg-white rounded-xl shadow-md p-12 text-center">
                        <Users className="w-24 h-24 text-gray-300 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-gray-400 mb-2">××™×Ÿ ×œ×§×•×—×•×ª ×œ××¦×•×</h3>
                        <p className="text-gray-400">
                          {search ? '× ×¡×” ×—×™×¤×•×© ××—×¨' : '×”×ª×—×œ ×¢×œ ×™×“×™ ×”×•×¡×¤×ª ×œ×§×•×— ×¨××©×•×Ÿ'}
                        </p>
                      </div>
                    ) : (
                      <div>
                        {/* Desktop Table View */}
                        <div className="hidden md:block bg-white rounded-xl shadow-md overflow-hidden">
                          <div className="overflow-x-auto">
                            <table className="w-full">
                              <thead className="bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
                                <tr>
                                  <th className="px-6 py-4 text-right text-sm font-bold">×©× ××œ×</th>
                                  <th className="px-6 py-4 text-right text-sm font-bold">×ª×¢×•×“×ª ×–×”×•×ª</th>
                                  <th className="px-6 py-4 text-right text-sm font-bold">×˜×œ×¤×•×Ÿ</th>
                                  <th className="px-6 py-4 text-right text-sm font-bold">××™××™×™×œ</th>
                                  <th className="px-6 py-4 text-right text-sm font-bold">×¤×•×œ×™×¡×•×ª</th>
                                  <th className="px-6 py-4 text-center text-sm font-bold">×¤×¢×•×œ×•×ª</th>
                                </tr>
                              </thead>
                              <tbody>
                              {filteredClients.map((client, index) => (
                                <tr
                                  key={client.id}
                                  onClick={() => setViewClient(client)}
                                  className={`table-row cursor-pointer border-b border-gray-200 transition-colors ${
                                    index % 2 === 0 ? 'bg-white' : 'bg-gray-50'
                                  }`}
                                >
                                  <td className="px-6 py-4">
                                    <div className="font-semibold text-gray-800">
                                      {client.firstName} {client.name}
                                    </div>
                                  </td>
                                  <td className="px-6 py-4 text-gray-600">{client.idNumber}</td>
                                  <td className="px-6 py-4 text-gray-600">{client.phone1 || '-'}</td>
                                  <td className="px-6 py-4 text-gray-600">
                                    <div className="truncate max-w-xs">{client.email1 || '-'}</div>
                                  </td>
                                  <td className="px-6 py-4">
                                    <span className="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">
                                      <Document className="w-4 h-4" />
                                      {getClientPolicies(client.id).length}
                                    </span>
                                  </td>
                                  <td className="px-6 py-4">
                                    <div className="flex items-center justify-center gap-2">
                                      <button
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          setModal('editClient');
                                          setForm(client);
                                          setErrors({});
                                        }}
                                        className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors"
                                        title="×¢×¨×™×›×”"
                                      >
                                        <Edit className="w-4 h-4" />
                                      </button>
                                      <button
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          handleDeleteClient(client.id);
                                        }}
                                        className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors"
                                        title="××—×™×§×”"
                                      >
                                        <Trash className="w-4 h-4" />
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                        <div className="bg-gray-50 px-6 py-4 border-t border-gray-200">
                          <div className="text-sm text-gray-600">
                            ×¡×”"×› {filteredClients.length} ×œ×§×•×—×•×ª
                          </div>
                        </div>
                      </div>
                      
                      {/* Mobile Card View */}
                      <div className="md:hidden space-y-3">
                        {filteredClients.map((client) => (
                          <div
                            key={client.id}
                            onClick={() => setViewClient(client)}
                            className="bg-white rounded-lg shadow-md p-4 border border-gray-200 active:bg-gray-50"
                          >
                            <div className="flex justify-between items-start mb-3">
                              <div className="font-bold text-lg text-gray-800">
                                {client.firstName} {client.name}
                              </div>
                              <span className="inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">
                                <Document className="w-3 h-3" />
                                {getClientPolicies(client.id).length}
                              </span>
                            </div>
                            <div className="space-y-2 text-sm text-gray-600">
                              <div className="flex items-center gap-2">
                                <span className="font-semibold">×ª.×–:</span>
                                {client.idNumber}
                              </div>
                              {client.phone1 && (
                                <div className="flex items-center gap-2">
                                  <span className="font-semibold">×˜×œ×¤×•×Ÿ:</span>
                                  <a href={`tel:${client.phone1}`} className="text-blue-600" onClick={(e) => e.stopPropagation()}>
                                    {client.phone1}
                                  </a>
                                </div>
                              )}
                              {client.email1 && (
                                <div className="flex items-center gap-2">
                                  <span className="font-semibold">××™××™×™×œ:</span>
                                  <a href={`mailto:${client.email1}`} className="text-blue-600 truncate" onClick={(e) => e.stopPropagation()}>
                                    {client.email1}
                                  </a>
                                </div>
                              )}
                            </div>
                            <div className="flex gap-2 mt-3 pt-3 border-t border-gray-200">
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  setModal('client');
                                  setForm(client);
                                  setErrors({});
                                }}
                                className="flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold"
                              >
                                <Edit className="w-4 h-4" />
                                ×¢×¨×•×š
                              </button>
                              <button
                                onClick={(e) => {
                                  e.stopPropagation();
                                  handleDeleteClient(client.id);
                                }}
                                className="flex-1 flex items-center justify-center gap-1 px-3 py-2 bg-red-600 text-white rounded-lg text-sm font-semibold"
                              >
                                <Trash className="w-4 h-4" />
                                ××—×§
                              </button>
                            </div>
                          </div>
                        ))}
                        <div className="bg-gray-100 rounded-lg p-3 text-center text-sm text-gray-600 font-semibold">
                          ×¡×”"×› {filteredClients.length} ×œ×§×•×—×•×ª
                        </div>
                      </div>
                    </div>}
                  </div>
                )}

                {/* Policies Tab */}
                {tab === 'policies' && (
                  <div>
                    {filterType && (
                      <div className="bg-blue-100 border border-blue-300 rounded-lg p-4 mb-4 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <span className="font-semibold text-blue-800">
                            ğŸ” ××¡× ×Ÿ ×¤×¢×™×œ: {
                              filterType === 'active' ? '×¤×•×œ×™×¡×•×ª ×¤×¢×™×œ×•×ª' :
                              filterType === 'expired' ? '×¤×•×œ×™×¡×•×ª ×©×¤×’ ×ª×•×§×¤×Ÿ' :
                              filterType === 'renewals' ? '×—×™×“×•×©×™× ×‘×—×•×“×©×™×™×' :
                              filterType === 'scans' ? '×¤×•×œ×™×¡×•×ª ×¢× ××¡××›×™× ×¡×¨×•×§×™×' :
                              ''
                            }
                          </span>
                        </div>
                        <button
                          onClick={() => setFilterType(null)}
                          className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                          <Close className="w-4 h-4" />
                          × ×§×” ×¡×™× ×•×Ÿ
                        </button>
                      </div>
                    )}
                    <div className="flex flex-col sm:flex-row gap-3 sm:gap-4 mb-6">
                      <input
                        type="text"
                        placeholder="ğŸ” ×—×™×¤×•×© ×¤×•×œ×™×¡×”..."
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                        className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-base sm:text-lg"
                      />
                      <button
                        onClick={() => {
                          setModal('policy');
                          setForm({});
                          setErrors({});
                        }}
                        className="flex items-center justify-center gap-2 px-4 sm:px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors text-sm sm:text-base"
                      >
                        <Plus className="w-4 h-4 sm:w-5 sm:h-5" />
                        <span className="hidden sm:inline">×”×•×¡×¤×ª ×¤×•×œ×™×¡×”</span>
                        <span className="sm:hidden">×”×•×¡×£ ×¤×•×œ×™×¡×”</span>
                      </button>
                    </div>

                    {filteredPolicies.length === 0 ? (
                      <div className="bg-white rounded-xl shadow-md p-12 text-center">
                        <Document className="w-24 h-24 text-gray-300 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-gray-400 mb-2">××™×Ÿ ×¤×•×œ×™×¡×•×ª ×œ××¦×•×</h3>
                        <p className="text-gray-400">
                          {search ? '× ×¡×” ×—×™×¤×•×© ××—×¨' : '×”×ª×—×œ ×¢×œ ×™×“×™ ×”×•×¡×¤×ª ×¤×•×œ×™×¡×” ×¨××©×•× ×”'}
                        </p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {filteredPolicies.map(policy => {
                          const client = clients.find(c => c.id === policy.clientId);
                          const daysLeft = getDaysLeft(policy.endDate);
                          return (
                            <div
                              key={policy.id}
                              onClick={() => setViewPolicy(policy)}
                              className="policy-card bg-white rounded-xl shadow-md p-6 hover:shadow-xl transition-all"
                            >
                              <div className="flex items-start justify-between">
                                <div className="flex-1">
                                  <div className="flex items-center gap-3 mb-2">
                                    <h3 className="text-lg font-bold text-gray-800">
                                      {client?.firstName} {client?.name}
                                    </h3>
                                    {daysLeft !== null && daysLeft <= 60 && daysLeft > 0 && (
                                      <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                                        daysLeft <= 7 ? 'bg-red-100 text-red-700' :
                                        daysLeft <= 30 ? 'bg-orange-100 text-orange-700' :
                                        'bg-yellow-100 text-yellow-700'
                                      }`}>
                                        {daysLeft} ×™××™× ×œ×—×™×“×•×©
                                      </span>
                                    )}
                                  </div>
                                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                      <div className="text-gray-500 mb-1">××¡×¤×¨ ×¤×•×œ×™×¡×”</div>
                                      <div className="font-semibold">{policy.policyNumber}</div>
                                    </div>
                                    <div>
                                      <div className="text-gray-500 mb-1">×¡×•×’</div>
                                      <div className="font-semibold">{policy.policyType}</div>
                                    </div>
                                    <div>
                                      <div className="text-gray-500 mb-1">×—×‘×¨×”</div>
                                      <div className="font-semibold">{policy.company}</div>
                                    </div>
                                    <div>
                                      <div className="text-gray-500 mb-1">×ª×•×§×£</div>
                                      <div className="font-semibold">
                                        {policy.startDate} - {policy.endDate}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div className="flex gap-2">
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      setModal('editPolicy');
                                      setForm(policy);
                                      setErrors({});
                                    }}
                                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                  >
                                    <Edit className="w-5 h-5" />
                                  </button>
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      handleDeletePolicy(policy.id);
                                    }}
                                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                  >
                                    <Trash className="w-5 h-5" />
                                  </button>
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                )}

                {/* Renewals Tab */}
                {tab === 'renewals' && (
                  <div>
                    <div className="bg-white rounded-xl shadow-md p-6 mb-6">
                      <h2 className="text-2xl font-bold mb-2">ğŸ”” ×ª×–×›×•×¨×•×ª ×—×™×“×•×© ×¤×•×œ×™×¡×•×ª</h2>
                      <p className="text-gray-600">×¤×•×œ×™×¡×•×ª ×©×“×•×¨×©×•×ª ×ª×©×•××ª ×œ×‘ ×‘×—×•×“×©×™×™× ×”×§×¨×•×‘×™×</p>
                    </div>

                    {Object.keys(getUpcomingRenewals()).length === 0 ? (
                      <div className="bg-white rounded-xl shadow-md p-12 text-center">
                        <Bell className="w-24 h-24 text-gray-300 mx-auto mb-4" />
                        <h3 className="text-xl font-bold text-gray-400 mb-2">××™×Ÿ ×ª×–×›×•×¨×•×ª</h3>
                        <p className="text-gray-400">×›×œ ×”×¤×•×œ×™×¡×•×ª ×‘×ª×•×§×£ ××¨×•×š</p>
                      </div>
                    ) : (
                      <div className="space-y-6">
                        {Object.entries(getUpcomingRenewals()).map(([period, renewals]) => (
                          <div key={period} className="bg-white rounded-xl shadow-md overflow-hidden">
                            <button
                              onClick={() => setExpandedMonths({ ...expandedMonths, [period]: !expandedMonths[period] })}
                              className="w-full flex items-center justify-between p-6 bg-gradient-to-r from-orange-50 to-orange-100 hover:from-orange-100 hover:to-orange-200 transition-colors"
                            >
                              <div className="flex items-center gap-3">
                                <Calendar className="w-6 h-6 text-orange-600" />
                                <span className="text-xl font-bold text-gray-800">{period}</span>
                                <span className="bg-orange-200 text-orange-800 px-3 py-1 rounded-full text-sm font-bold">
                                  {renewals.length} ×¤×•×œ×™×¡×•×ª
                                </span>
                              </div>
                              {expandedMonths[period] ? (
                                <ChevronUp className="w-6 h-6 text-gray-600" />
                              ) : (
                                <ChevronDown className="w-6 h-6 text-gray-600" />
                              )}
                            </button>

                            {expandedMonths[period] && (
                              <div className="p-6 space-y-3">
                                {renewals.map(policy => {
                                  const client = clients.find(c => c.id === policy.clientId);
                                  const daysLeft = getDaysLeft(policy.endDate);
                                  return (
                                    <div
                                      key={policy.id}
                                      onClick={() => {
                                        setViewPolicy(policy);
                                        setTab('policies');
                                      }}
                                      className="policy-card border-2 border-orange-200 bg-orange-50 rounded-lg p-4"
                                    >
                                      <div className="flex items-center justify-between">
                                        <div className="flex-1">
                                          <div className="font-bold text-lg mb-1">
                                            {client?.firstName} {client?.name}
                                          </div>
                                          <div className="grid grid-cols-3 gap-4 text-sm">
                                            <div>
                                              <span className="text-gray-600">×¡×•×’: </span>
                                              <span className="font-semibold">{policy.policyType}</span>
                                            </div>
                                            <div>
                                              <span className="text-gray-600">×—×‘×¨×”: </span>
                                              <span className="font-semibold">{policy.company}</span>
                                            </div>
                                            <div>
                                              <span className="text-gray-600">×ª×•×§×£ ×¢×“: </span>
                                              <span className="font-semibold">{policy.endDate}</span>
                                            </div>
                                          </div>
                                        </div>
                                        <div className={`text-lg font-bold px-4 py-2 rounded-full ${
                                          daysLeft <= 7 ? 'bg-red-100 text-red-700' :
                                          daysLeft <= 14 ? 'bg-orange-100 text-orange-700' :
                                          daysLeft <= 30 ? 'bg-yellow-100 text-yellow-700' :
                                          'bg-blue-100 text-blue-700'
                                        }`}>
                                          {daysLeft} ×™××™×
                                        </div>
                                      </div>
                                    </div>
                                  );
                                })}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}
              </div>

              {/* Client Modal */}
              {(modal === 'client' || modal === 'editClient') && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                  <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-2xl font-bold">
                        {modal === 'client' ? 'ğŸ‘¤ ×”×•×¡×¤×ª ×œ×§×•×— ×—×“×©' : 'âœï¸ ×¢×¨×™×›×ª ×œ×§×•×—'}
                      </h2>
                      <button onClick={() => { setModal(null); setForm({}); setErrors({}); }} className="text-gray-400 hover:text-gray-600">
                        <Close className="w-6 h-6" />
                      </button>
                    </div>

                    <div className="space-y-4">
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×©× ×¤×¨×˜×™</label>
                          <input
                            type="text"
                            value={form.firstName || ''}
                            onChange={(e) => setForm({ ...form, firstName: e.target.value })}
                            className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="×©× ×¤×¨×˜×™"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×©× ××©×¤×—×”</label>
                          <input
                            type="text"
                            value={form.name || ''}
                            onChange={(e) => setForm({ ...form, name: e.target.value })}
                            className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.name ? 'input-error' : ''}`}
                            placeholder="×©× ××©×¤×—×”"
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×ª×¢×•×“×ª ×–×”×•×ª</label>
                          <input
                            type="text"
                            value={form.idNumber || ''}
                            onChange={(e) => setForm({ ...form, idNumber: e.target.value })}
                            className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.idNumber ? 'input-error' : ''}`}
                            placeholder="123456789"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">×ª××¨×™×š ×œ×™×“×”</label>
                          <input
                            type="date"
                            value={form.birthDate || ''}
                            onChange={(e) => setForm({ ...form, birthDate: e.target.value })}
                            className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold mb-2">××™××™×™×œ 1</label>
                        <input
                          type="email"
                          value={form.email1 || ''}
                          onChange={(e) => setForm({ ...form, email1: e.target.value })}
                          className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                          placeholder="email@example.com"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×˜×œ×¤×•×Ÿ 1</label>
                          <input
                            type="tel"
                            value={form.phone1 || ''}
                            onChange={(e) => setForm({ ...form, phone1: e.target.value })}
                            className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.phone1 ? 'input-error' : ''}`}
                            placeholder="050-1234567"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">×¡×•×’ ×˜×œ×¤×•×Ÿ</label>
                          <select
                            value={form.phone1Type || ''}
                            onChange={(e) => setForm({ ...form, phone1Type: e.target.value })}
                            className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                          >
                            <option value="">×‘×—×¨ ×¡×•×’</option>
                            <option value="Mobile">× ×™×™×“</option>
                            <option value="Home">×‘×™×ª</option>
                            <option value="×¢×‘×•×“×”">×¢×‘×•×“×”</option>
                            <option value="Other">××—×¨</option>
                          </select>
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold mb-2">×”×¢×¨×•×ª</label>
                        <textarea
                          value={form.notes || ''}
                          onChange={(e) => setForm({ ...form, notes: e.target.value })}
                          className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                          rows="3"
                          placeholder="×”×¢×¨×•×ª × ×•×¡×¤×•×ª..."
                        />
                      </div>

                      <div className="flex gap-3 pt-4">
                        <button
                          onClick={modal === 'client' ? handleAddClient : handleEditClient}
                          disabled={saving}
                          className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 transition-colors"
                        >
                          {saving ? 'â³ ×©×•××¨...' : modal === 'client' ? 'âœ… ×”×•×¡×£ ×œ×§×•×—' : 'âœ… ×¢×“×›×Ÿ ×œ×§×•×—'}
                        </button>
                        <button
                          onClick={() => { setModal(null); setForm({}); setErrors({}); }}
                          className="px-8 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                        >
                          ×‘×™×˜×•×œ
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Policy Modal */}
              {(modal === 'policy' || modal === 'editPolicy') && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                  <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
                    <div className="flex items-center justify-between mb-6">
                      <h2 className="text-2xl font-bold">
                        {modal === 'policy' ? 'ğŸ“„ ×”×•×¡×¤×ª ×¤×•×œ×™×¡×” ×—×“×©×”' : 'âœï¸ ×¢×¨×™×›×ª ×¤×•×œ×™×¡×”'}
                      </h2>
                      <button onClick={() => { setModal(null); setForm({}); setErrors({}); }} className="text-gray-400 hover:text-gray-600">
                        <Close className="w-6 h-6" />
                      </button>
                    </div>

                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-2 required-label">×œ×§×•×—</label>
                        <select
                          value={form.clientId || ''}
                          onChange={(e) => setForm({ ...form, clientId: parseInt(e.target.value) })}
                          className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.clientId ? 'input-error' : ''}`}
                          disabled={modal === 'editPolicy'}
                        >
                          <option value="">×‘×—×¨ ×œ×§×•×—</option>
                          {clients.map(c => (
                            <option key={c.id} value={c.id}>
                              {c.firstName} {c.name} - {c.idNumber}
                            </option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold mb-2 required-label">××¡×¤×¨ ×¤×•×œ×™×¡×”</label>
                        <input
                          type="text"
                          value={form.policyNumber || ''}
                          onChange={(e) => setForm({ ...form, policyNumber: e.target.value })}
                          className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.policyNumber ? 'input-error' : ''}`}
                          placeholder="××¡×¤×¨ ×¤×•×œ×™×¡×”"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×¡×•×’ ×¤×•×œ×™×¡×”</label>
                          <input
                            type="text"
                            value={form.policyType || ''}
                            onChange={(e) => setForm({ ...form, policyType: e.target.value })}
                            className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.policyType ? 'input-error' : ''}`}
                            placeholder="×¨×›×‘, ×“×™×¨×”, ×‘×¨×™××•×ª..."
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">×¡×•×’ ×‘×™×˜×•×—</label>
                          <input
                            type="text"
                            value={form.insuranceType || ''}
                            onChange={(e) => setForm({ ...form, insuranceType: e.target.value })}
                            className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="××§×™×£, ×¦×“ ×’'..."
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold mb-2 required-label">×—×‘×¨×ª ×‘×™×˜×•×—</label>
                        <input
                          type="text"
                          value={form.company || ''}
                          onChange={(e) => setForm({ ...form, company: e.target.value })}
                          className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.company ? 'input-error' : ''}`}
                          placeholder="×©× ×—×‘×¨×ª ×”×‘×™×˜×•×—"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×ª××¨×™×š ×ª×—×™×œ×”</label>
                          <input
                            type="date"
                            value={form.startDate || ''}
                            onChange={(e) => setForm({ ...form, startDate: e.target.value })}
                            className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.startDate ? 'input-error' : ''}`}
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2 required-label">×ª××¨×™×š ×¡×™×•×</label>
                          <input
                            type="date"
                            value={form.endDate || ''}
                            onChange={(e) => setForm({ ...form, endDate: e.target.value })}
                            className={`w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none ${errors.endDate ? 'input-error' : ''}`}
                          />
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold mb-2">×¤×¨××™×”</label>
                          <input
                            type="text"
                            value={form.premium || ''}
                            onChange={(e) => setForm({ ...form, premium: e.target.value })}
                            className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="×¡×›×•×"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">××¡×¤×¨ ×¨×›×‘</label>
                          <input
                            type="text"
                            value={form.carNumber || ''}
                            onChange={(e) => setForm({ ...form, carNumber: e.target.value })}
                            className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="××¡×¤×¨ ×¨×™×©×•×™"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold mb-2">×”×¢×¨×•×ª</label>
                        <textarea
                          value={form.notes || ''}
                          onChange={(e) => setForm({ ...form, notes: e.target.value })}
                          className="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none"
                          rows="3"
                          placeholder="×”×¢×¨×•×ª × ×•×¡×¤×•×ª..."
                        />
                      </div>

                      <div className="flex gap-3 pt-4">
                        <button
                          onClick={modal === 'policy' ? handleAddPolicy : handleEditPolicy}
                          disabled={saving}
                          className="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400 transition-colors"
                        >
                          {saving ? 'â³ ×©×•××¨...' : modal === 'policy' ? 'âœ… ×”×•×¡×£ ×¤×•×œ×™×¡×”' : 'âœ… ×¢×“×›×Ÿ ×¤×•×œ×™×¡×”'}
                        </button>
                        <button
                          onClick={() => { setModal(null); setForm({}); setErrors({}); }}
                          className="px-8 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                        >
                          ×‘×™×˜×•×œ
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* View Client Modal */}
              {viewClient && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                  <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-6 rounded-t-lg z-10">
                      <div className="flex items-center justify-between">
                        <div>
                          <h2 className="text-2xl font-bold mb-1">
                            ğŸ‘¤ {viewClient.firstName} {viewClient.name}
                          </h2>
                          <div className="text-blue-100">×ª.×–: {viewClient.idNumber}</div>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={() => {
                              setModal('editClient');
                              setForm(viewClient);
                              setErrors({});
                            }}
                            className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                            title="×¢×¨×™×›×ª ×œ×§×•×—"
                          >
                            <Edit className="w-6 h-6" />
                          </button>
                          <button
                            onClick={() => setViewClient(null)}
                            className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                            title="×¡×’×™×¨×”"
                          >
                            <Close className="w-6 h-6" />
                          </button>
                        </div>
                      </div>
                    </div>

                    <div className="p-6">
                      {/* Client Details */}
                      <div className="bg-gray-50 rounded-lg p-6 mb-6">
                        <h3 className="text-lg font-bold mb-4">ğŸ“‹ ×¤×¨×˜×™ ×”×œ×§×•×—</h3>
                        <div className="grid grid-cols-2 gap-4">
                          {viewClient.birthDate && (
                            <div>
                              <div className="text-sm text-gray-500">×ª××¨×™×š ×œ×™×“×”</div>
                              <div className="font-semibold">{viewClient.birthDate}</div>
                            </div>
                          )}
                          {viewClient.email1 && (
                            <div>
                              <div className="text-sm text-gray-500">××™××™×™×œ</div>
                              <div className="font-semibold">{viewClient.email1}</div>
                            </div>
                          )}
                          {viewClient.phone1 && (
                            <div>
                              <div className="text-sm text-gray-500">×˜×œ×¤×•×Ÿ</div>
                              <div className="font-semibold">{viewClient.phone1} ({viewClient.phone1Type})</div>
                            </div>
                          )}
                          {viewClient.phone2 && (
                            <div>
                              <div className="text-sm text-gray-500">×˜×œ×¤×•×Ÿ × ×•×¡×£</div>
                              <div className="font-semibold">{viewClient.phone2} ({viewClient.phone2Type})</div>
                            </div>
                          )}
                        </div>
                        {viewClient.notes && (
                          <div className="mt-4">
                            <div className="text-sm text-gray-500 mb-1">×”×¢×¨×•×ª</div>
                            <div className="text-gray-700">{viewClient.notes}</div>
                          </div>
                        )}
                      </div>

                      {/* Client Policies */}
                      <div>
                        <div className="flex items-center justify-between mb-4">
                          <h3 className="text-lg font-bold">ğŸ“„ ×¤×•×œ×™×¡×•×ª ({getClientPolicies(viewClient.id).length})</h3>
                          <button
                            onClick={() => {
                              setModal('policy');
                              setForm({ clientId: viewClient.id });
                              setErrors({});
                            }}
                            className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors"
                          >
                            <Plus className="w-4 h-4" />
                            ×”×•×¡×£ ×¤×•×œ×™×¡×”
                          </button>
                        </div>

                        {getClientPolicies(viewClient.id).length === 0 ? (
                          <div className="text-center py-12 bg-gray-50 rounded-lg">
                            <Document className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                            <div className="text-gray-500">××™×Ÿ ×¤×•×œ×™×¡×•×ª ×œ×œ×§×•×— ×–×”</div>
                          </div>
                        ) : (
                          <div className="space-y-3">
                            {getClientPolicies(viewClient.id).map(policy => {
                              const daysLeft = getDaysLeft(policy.endDate);
                              return (
                                <div
                                  key={policy.id}
                                  className="border-2 border-gray-200 bg-white rounded-lg p-4 hover:border-blue-300 hover:shadow-md transition-all"
                                >
                                  <div className="flex items-start justify-between mb-3">
                                    <div 
                                      className="flex-1 cursor-pointer"
                                      onClick={() => {
                                        setViewPolicy(policy);
                                        setViewClient(null);
                                      }}
                                    >
                                      <div className="flex items-center gap-3">
                                        <div className="font-bold text-lg">{policy.policyType}</div>
                                        {daysLeft !== null && daysLeft <= 60 && daysLeft > 0 && (
                                          <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                                            daysLeft <= 7 ? 'bg-red-100 text-red-700' :
                                            daysLeft <= 30 ? 'bg-orange-100 text-orange-700' :
                                            'bg-yellow-100 text-yellow-700'
                                          }`}>
                                            {daysLeft} ×™××™× ×œ×—×™×“×•×©
                                          </span>
                                        )}
                                      </div>
                                    </div>
                                    <div className="flex gap-2">
                                      <button
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          setModal('editPolicy');
                                          setForm(policy);
                                          setErrors({});
                                        }}
                                        className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors"
                                        title="×¢×¨×™×›×ª ×¤×•×œ×™×¡×”"
                                      >
                                        <Edit className="w-5 h-5" />
                                      </button>
                                      <button
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          handleDeletePolicy(policy.id);
                                        }}
                                        className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors"
                                        title="××—×™×§×ª ×¤×•×œ×™×¡×”"
                                      >
                                        <Trash className="w-5 h-5" />
                                      </button>
                                      <button
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          setViewPolicy(policy);
                                          setViewClient(null);
                                        }}
                                        className="p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors"
                                        title="×¦×¤×™×™×” ×‘×¤×•×œ×™×¡×”"
                                      >
                                        <Eye className="w-5 h-5" />
                                      </button>
                                    </div>
                                  </div>
                                  <div 
                                    className="grid grid-cols-3 gap-4 text-sm cursor-pointer"
                                    onClick={() => {
                                      setViewPolicy(policy);
                                      setViewClient(null);
                                    }}
                                  >
                                    <div>
                                      <div className="text-gray-500">××¡×¤×¨ ×¤×•×œ×™×¡×”</div>
                                      <div className="font-semibold">{policy.policyNumber}</div>
                                    </div>
                                    <div>
                                      <div className="text-gray-500">×—×‘×¨×”</div>
                                      <div className="font-semibold">{policy.company}</div>
                                    </div>
                                    <div>
                                      <div className="text-gray-500">×ª×•×§×£</div>
                                      <div className="font-semibold">{policy.startDate} - {policy.endDate}</div>
                                    </div>
                                  </div>
                                </div>
                              );
                            })}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* View Policy Modal */}
              {viewPolicy && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                  <div className="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-gradient-to-r from-green-600 to-emerald-700 text-white p-6 rounded-t-lg z-10">
                      <div className="flex items-center justify-between">
                        <div>
                          <h2 className="text-2xl font-bold mb-1">ğŸ“„ {viewPolicy.policyType}</h2>
                          <div className="text-green-100">××¡×¤×¨ ×¤×•×œ×™×¡×”: {viewPolicy.policyNumber}</div>
                        </div>
                        <button
                          onClick={() => setViewPolicy(null)}
                          className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                        >
                          <Close className="w-6 h-6" />
                        </button>
                      </div>
                    </div>

                    <div className="p-6 space-y-6">
                      {/* Policy Details */}
                      <div className="bg-gray-50 rounded-lg p-6">
                        <h3 className="text-lg font-bold mb-4">ğŸ“‹ ×¤×¨×˜×™ ×”×¤×•×œ×™×¡×”</h3>
                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <div className="text-sm text-gray-500">×œ×§×•×—</div>
                            <div className="font-semibold">
                              {(() => {
                                const client = clients.find(c => c.id === viewPolicy.clientId);
                                return client ? `${client.firstName} ${client.name}` : '×œ× × ××¦×';
                              })()}
                            </div>
                          </div>
                          <div>
                            <div className="text-sm text-gray-500">×¡×•×’ ×‘×™×˜×•×—</div>
                            <div className="font-semibold">{viewPolicy.insuranceType}</div>
                          </div>
                          <div>
                            <div className="text-sm text-gray-500">×—×‘×¨×”</div>
                            <div className="font-semibold">{viewPolicy.company}</div>
                          </div>
                          <div>
                            <div className="text-sm text-gray-500">×¤×¨××™×”</div>
                            <div className="font-semibold">{viewPolicy.premium}</div>
                          </div>
                          <div>
                            <div className="text-sm text-gray-500">×ª××¨×™×š ×ª×—×™×œ×”</div>
                            <div className="font-semibold">{viewPolicy.startDate}</div>
                          </div>
                          <div>
                            <div className="text-sm text-gray-500">×ª××¨×™×š ×¡×™×•×</div>
                            <div className="font-semibold">{viewPolicy.endDate}</div>
                          </div>
                          {viewPolicy.carNumber && (
                            <div>
                              <div className="text-sm text-gray-500">××¡×¤×¨ ×¨×›×‘</div>
                              <div className="font-semibold">{viewPolicy.carNumber}</div>
                            </div>
                          )}
                          {(() => {
                            const daysLeft = getDaysLeft(viewPolicy.endDate);
                            if (daysLeft !== null) {
                              return (
                                <div>
                                  <div className="text-sm text-gray-500">×–××Ÿ ×¢×“ ×—×™×“×•×©</div>
                                  <div className={`font-bold ${
                                    daysLeft <= 7 ? 'text-red-600' :
                                    daysLeft <= 30 ? 'text-orange-600' :
                                    daysLeft <= 60 ? 'text-yellow-600' :
                                    'text-green-600'
                                  }`}>
                                    {daysLeft > 0 ? `${daysLeft} ×™××™×` : '×¤×’ ×ª×•×§×£'}
                                  </div>
                                </div>
                              );
                            }
                            return null;
                          })()}
                        </div>
                        {viewPolicy.notes && (
                          <div className="mt-4">
                            <div className="text-sm text-gray-500 mb-1">×”×¢×¨×•×ª</div>
                            <div className="text-gray-700">{viewPolicy.notes}</div>
                          </div>
                        )}
                      </div>

                      {/* Scanned Documents */}
                      <div className="bg-blue-50 rounded-lg p-6">
                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                          <Scan className="w-5 h-5" />
                          ××¡××›×™× ×¡×¨×•×§×™× ({(viewPolicy.scans || []).length})
                        </h3>
                        
                        <label className="flex items-center justify-center gap-3 px-4 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 cursor-pointer mb-4">
                          <Upload className="w-5 h-5" />
                          {uploadingFile ? 'â³ ××¢×œ×”...' : '×”×¢×œ××ª ××¡××›×™×'}
                          <input 
                            type="file" 
                            multiple 
                            accept="image/*,.pdf"
                            onChange={(e) => handleFileUpload(e, viewPolicy.id)}
                            className="hidden"
                            disabled={uploadingFile}
                          />
                        </label>

                        <div className="space-y-3 max-h-96 overflow-y-auto">
                          {(viewPolicy.scans || []).length === 0 ? (
                            <div className="text-center py-12">
                              <div className="scan-icon mx-auto mb-4">
                                <Scan className="w-12 h-12" />
                              </div>
                              <div className="text-gray-600">××™×Ÿ ××¡××›×™× ×¡×¨×•×§×™×</div>
                              <div className="text-sm text-gray-500 mt-1">×”×¢×œ×” ×ª××•× ×•×ª ××• PDF ×©×œ ×”××¡××›×™×</div>
                            </div>
                          ) : (
                            <div className="grid grid-cols-2 gap-3">
                              {viewPolicy.scans.map((scan, index) => (
                                <div key={index} className="file-item">
                                  {scan.type.startsWith('image/') ? (
                                    <img 
                                      src={scan.data} 
                                      alt={scan.name}
                                      className="file-preview"
                                      onClick={() => setViewImage(scan)}
                                    />
                                  ) : (
                                    <div 
                                      className="file-preview flex flex-col items-center justify-center bg-gray-100 cursor-pointer hover:bg-gray-200"
                                      onClick={() => {
                                        const link = document.createElement('a');
                                        link.href = scan.data;
                                        link.download = scan.name;
                                        link.click();
                                      }}
                                    >
                                      <Document className="w-12 h-12 text-gray-600" />
                                      <div className="text-xs text-gray-600 mt-2 px-2 text-center break-all">{scan.name}</div>
                                    </div>
                                  )}
                                  <button
                                    className="delete-file"
                                    onClick={() => deleteFile(viewPolicy.id, index)}
                                  >
                                    âœ•
                                  </button>
                                  <div className="text-xs text-gray-600 mt-1 text-center truncate">
                                    {scan.name}
                                  </div>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Image Viewer Modal */}
              {viewImage && (
                <div 
                  className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-[60]"
                  onClick={() => setViewImage(null)}
                >
                  <div className="relative max-w-6xl max-h-full">
                    <button
                      onClick={() => setViewImage(null)}
                      className="absolute top-4 right-4 bg-white text-black p-2 rounded-full hover:bg-gray-200 z-10"
                    >
                      <Close className="w-6 h-6" />
                    </button>
                    <img 
                      src={viewImage.data} 
                      alt={viewImage.name}
                      className="max-w-full max-h-[90vh] object-contain rounded-lg"
                      onClick={(e) => e.stopPropagation()}
                    />
                    <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-white text-black px-4 py-2 rounded-lg">
                      {viewImage.name}
                    </div>
                  </div>
                </div>
              )}

              {/* Toast Notification */}
              {toast && (
                <div className={`toast toast-${toast.type}`}>
                  {toast.message}
                </div>
              )}

              {/* Confirm Dialog */}
              {confirmDialog && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 modal-overlay">
                  <div className="bg-white rounded-lg max-w-md w-full p-6">
                    <h3 className="text-xl font-bold mb-4">âš ï¸ ××™×©×•×¨</h3>
                    <p className="text-gray-700 mb-6">{confirmDialog.message}</p>
                    <div className="flex gap-3">
                      <button 
                        onClick={() => {
                          confirmDialog.onConfirm();
                          setConfirmDialog(null);
                        }} 
                        className="flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700"
                      >
                        ×›×Ÿ, ×× ×™ ×‘×˜×•×—
                      </button>
                      <button 
                        onClick={() => setConfirmDialog(null)} 
                        className="flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300"
                      >
                        ×‘×™×˜×•×œ
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
